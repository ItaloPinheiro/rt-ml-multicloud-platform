groups:
- name: ml_pipeline_alerts
  interval: 30s
  rules:
  - alert: HighErrorRate
    expr: (sum(rate(ml_predictions_total{status="error"}[5m])) / sum(rate(ml_predictions_total[5m])))
      > 0.05
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: High error rate detected
      description: Error rate is above 5% over the last 5 minutes
  - alert: HighPredictionLatency
    expr: histogram_quantile(0.95, rate(ml_prediction_duration_seconds_bucket[5m]))
      > 0.5
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: High prediction latency
      description: 95th percentile latency is {{ $value }}s
  - alert: CriticalPredictionLatency
    expr: histogram_quantile(0.95, rate(ml_prediction_duration_seconds_bucket[5m]))
      > 1.0
    for: 2m
    labels:
      severity: critical
    annotations:
      summary: Critical prediction latency
      description: '95th percentile latency is {{ $value }}s (threshold: 1s)'
  - alert: ModelAPIDown
    expr: up{job="ml-pipeline-api-service"} == 0
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: Model API service is down
      description: The ML Model API has been down for more than 1 minute
  - alert: LowCacheHitRate
    expr: (rate(redis_keyspace_hits_total[5m]) / (rate(redis_keyspace_hits_total[5m])
      + rate(redis_keyspace_misses_total[5m]))) < 0.5
    for: 10m
    labels:
      severity: warning
    annotations:
      summary: Low Redis cache hit rate
      description: Cache hit rate is {{ $value }}
  - alert: NoPredictions
    expr: rate(ml_predictions_total[5m]) == 0
    for: 10m
    labels:
      severity: warning
    annotations:
      summary: No predictions being made
      description: The API hasn't received any prediction requests in the last 10
        minutes
